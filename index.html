<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calendario de Objetivos</title>
    <style>
:root {
  --color-white: rgba(255, 255, 255, 1);
  --color-black: rgba(0, 0, 0, 1);
  --color-cream-50: rgba(252, 252, 249, 1);
  --color-cream-100: rgba(255, 255, 253, 1);
  --color-gray-200: rgba(245, 245, 245, 1);
  --color-gray-300: rgba(167, 169, 169, 1);
  --color-gray-400: rgba(119, 124, 124, 1);
  --color-slate-500: rgba(98, 108, 113, 1);
  --color-brown-600: rgba(94, 82, 64, 1);
  --color-charcoal-700: rgba(31, 33, 33, 1);
  --color-charcoal-800: rgba(38, 40, 40, 1);
  --color-slate-900: rgba(19, 52, 59, 1);
  --color-teal-300: rgba(50, 184, 198, 1);
  --color-teal-400: rgba(45, 166, 178, 1);
  --color-teal-500: rgba(33, 128, 141, 1);
  --color-teal-600: rgba(29, 116, 128, 1);
  --color-teal-700: rgba(26, 104, 115, 1);
  --color-red-400: rgba(255, 84, 89, 1);
  --color-red-500: rgba(192, 21, 47, 1);
  --color-orange-400: rgba(230, 129, 97, 1);
  --color-orange-500: rgba(168, 75, 47, 1);
  --color-green-400: rgba(74, 222, 128, 1);
  --color-green-500: rgba(34, 197, 94, 1);
  --color-yellow-400: rgba(250, 204, 21, 1);
  
  --color-brown-600-rgb: 94, 82, 64;
  --color-teal-500-rgb: 33, 128, 141;
  --color-slate-900-rgb: 19, 52, 59;
  --color-slate-500-rgb: 98, 108, 113;
  
  --color-background: var(--color-cream-50);
  --color-surface: var(--color-cream-100);
  --color-text: var(--color-slate-900);
  --color-text-secondary: var(--color-slate-500);
  --color-primary: var(--color-teal-500);
  --color-primary-hover: var(--color-teal-600);
  --color-primary-active: var(--color-teal-700);
  --color-secondary: rgba(var(--color-brown-600-rgb), 0.12);
  --color-secondary-hover: rgba(var(--color-brown-600-rgb), 0.2);
  --color-border: rgba(var(--color-brown-600-rgb), 0.2);
  --color-card-border: rgba(var(--color-brown-600-rgb), 0.12);
  
  --font-family-base: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
  --radius-sm: 6px;
  --radius-base: 8px;
  --radius-md: 10px;
  --radius-lg: 12px;
  --space-4: 4px;
  --space-8: 8px;
  --space-12: 12px;
  --space-16: 16px;
  --space-20: 20px;
  --space-24: 24px;
  --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.04), 0 1px 2px rgba(0, 0, 0, 0.02);
  --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.04), 0 2px 4px -1px rgba(0, 0, 0, 0.02);
}

@media (prefers-color-scheme: dark) {
  :root {
    --color-gray-400-rgb: 119, 124, 124;
    --color-teal-300-rgb: 50, 184, 198;
    --color-gray-300-rgb: 167, 169, 169;
    --color-gray-200-rgb: 245, 245, 245;
    
    --color-background: var(--color-charcoal-700);
    --color-surface: var(--color-charcoal-800);
    --color-text: var(--color-gray-200);
    --color-text-secondary: rgba(var(--color-gray-300-rgb), 0.7);
    --color-primary: var(--color-teal-300);
    --color-primary-hover: var(--color-teal-400);
    --color-secondary: rgba(var(--color-gray-400-rgb), 0.15);
    --color-secondary-hover: rgba(var(--color-gray-400-rgb), 0.25);
    --color-border: rgba(var(--color-gray-400-rgb), 0.3);
    --color-card-border: rgba(var(--color-gray-400-rgb), 0.2);
  }
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: var(--font-family-base);
  background-color: var(--color-background);
  color: var(--color-text);
  padding: var(--space-20);
  line-height: 1.6;
}

.container {
  max-width: 1400px;
  margin: 0 auto;
}

.header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: var(--space-24);
  flex-wrap: wrap;
  gap: var(--space-16);
}

.header h1 {
  font-size: 28px;
  font-weight: 600;
  color: var(--color-text);
}

.month-nav {
  display: flex;
  align-items: center;
  gap: var(--space-16);
}

.month-nav button {
  background: var(--color-primary);
  color: white;
  border: none;
  padding: var(--space-8) var(--space-16);
  border-radius: var(--radius-base);
  cursor: pointer;
  font-size: 14px;
  font-weight: 500;
  transition: background 0.2s;
}

.month-nav button:hover {
  background: var(--color-primary-hover);
}

.month-nav span {
  font-size: 18px;
  font-weight: 600;
  min-width: 180px;
  text-align: center;
}

.stats-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
  gap: var(--space-16);
  margin-bottom: var(--space-24);
}

.stat-card {
  background: var(--color-surface);
  border: 1px solid var(--color-card-border);
  border-radius: var(--radius-lg);
  padding: var(--space-20);
  box-shadow: var(--shadow-sm);
}

.stat-card-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: var(--space-12);
}

.stat-card-header span {
  font-size: 13px;
  color: var(--color-text-secondary);
  font-weight: 500;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.stat-icon {
  font-size: 24px;
}

.stat-value {
  font-size: 32px;
  font-weight: 700;
  color: var(--color-text);
}

.stat-trend {
  font-size: 13px;
  margin-top: var(--space-8);
  display: flex;
  align-items: center;
  gap: var(--space-4);
}

.trend-up {
  color: var(--color-green-500);
}

.trend-down {
  color: var(--color-red-500);
}

.main-content {
  display: grid;
  grid-template-columns: 1fr 400px;
  gap: var(--space-24);
}

.calendar-section {
  background: var(--color-surface);
  border: 1px solid var(--color-card-border);
  border-radius: var(--radius-lg);
  padding: var(--space-24);
  box-shadow: var(--shadow-sm);
}

.calendar {
  display: grid;
  grid-template-columns: repeat(7, 1fr);
  gap: var(--space-8);
}

.calendar-header {
  font-size: 12px;
  font-weight: 600;
  text-align: center;
  padding: var(--space-8);
  color: var(--color-text-secondary);
  text-transform: uppercase;
}

.calendar-day {
  aspect-ratio: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  border: 1px solid var(--color-border);
  border-radius: var(--radius-base);
  cursor: pointer;
  transition: all 0.2s;
  position: relative;
  background: var(--color-surface);
}

.calendar-day:hover {
  border-color: var(--color-primary);
  transform: translateY(-2px);
  box-shadow: var(--shadow-md);
}

.calendar-day.empty {
  cursor: default;
  opacity: 0.3;
}

.calendar-day.empty:hover {
  border-color: var(--color-border);
  transform: none;
  box-shadow: none;
}

.calendar-day.success {
  background: rgba(34, 197, 94, 0.1);
  border-color: var(--color-green-500);
}

.calendar-day.partial {
  background: rgba(250, 204, 21, 0.1);
  border-color: var(--color-yellow-400);
}

.calendar-day.pending {
  background: rgba(255, 84, 89, 0.1);
  border-color: var(--color-red-400);
}

.calendar-day.today {
  border: 2px solid var(--color-primary);
  font-weight: 700;
}

.day-number {
  font-size: 14px;
  font-weight: 600;
}

.day-tasks {
  font-size: 10px;
  margin-top: var(--space-4);
  color: var(--color-text-secondary);
}

.sidebar {
  display: flex;
  flex-direction: column;
  gap: var(--space-24);
}

.objectives-section {
  background: var(--color-surface);
  border: 1px solid var(--color-card-border);
  border-radius: var(--radius-lg);
  padding: var(--space-24);
  box-shadow: var(--shadow-sm);
}

.section-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: var(--space-20);
}

.section-header h2 {
  font-size: 20px;
  font-weight: 600;
}

.btn-add {
  background: var(--color-primary);
  color: white;
  border: none;
  padding: var(--space-8) var(--space-16);
  border-radius: var(--radius-base);
  cursor: pointer;
  font-size: 14px;
  font-weight: 500;
  transition: background 0.2s;
}

.btn-add:hover {
  background: var(--color-primary-hover);
}

.objective-item {
  background: var(--color-background);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-md);
  padding: var(--space-16);
  margin-bottom: var(--space-12);
}

.objective-header {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  margin-bottom: var(--space-12);
}

.objective-title {
  font-size: 16px;
  font-weight: 600;
  color: var(--color-text);
  margin-bottom: var(--space-4);
}

.objective-desc {
  font-size: 13px;
  color: var(--color-text-secondary);
}

.objective-actions {
  display: flex;
  gap: var(--space-8);
}

.btn-icon {
  background: transparent;
  border: none;
  cursor: pointer;
  font-size: 18px;
  color: var(--color-text-secondary);
  transition: color 0.2s;
}

.btn-icon:hover {
  color: var(--color-primary);
}

.progress-section {
  margin-bottom: var(--space-12);
}

.progress-header {
  display: flex;
  justify-content: space-between;
  margin-bottom: var(--space-8);
}

.progress-label {
  font-size: 13px;
  color: var(--color-text-secondary);
}

.progress-percentage {
  font-size: 14px;
  font-weight: 600;
  color: var(--color-primary);
}

.progress-bar {
  height: 8px;
  background: var(--color-secondary);
  border-radius: 999px;
  overflow: hidden;
  position: relative;
}

.progress-fill {
  height: 100%;
  background: linear-gradient(90deg, var(--color-teal-500), var(--color-teal-300));
  border-radius: 999px;
  transition: width 0.5s ease;
  animation: shimmer 2s infinite;
}

@keyframes shimmer {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.8; }
}

.objective-status {
  display: inline-block;
  padding: var(--space-4) var(--space-12);
  border-radius: 999px;
  font-size: 12px;
  font-weight: 500;
}

.status-completed {
  background: rgba(34, 197, 94, 0.15);
  color: var(--color-green-500);
}

.status-progress {
  background: rgba(250, 204, 21, 0.15);
  color: var(--color-yellow-400);
}

.status-delayed {
  background: rgba(255, 84, 89, 0.15);
  color: var(--color-red-400);
}

.heatmap-section {
  background: var(--color-surface);
  border: 1px solid var(--color-card-border);
  border-radius: var(--radius-lg);
  padding: var(--space-24);
  box-shadow: var(--shadow-sm);
}

.heatmap-grid {
  display: grid;
  grid-template-columns: repeat(7, 1fr);
  gap: var(--space-4);
  margin-top: var(--space-16);
}

.heatmap-cell {
  aspect-ratio: 1;
  border-radius: var(--radius-sm);
  background: var(--color-secondary);
}

.heatmap-cell.level-0 { opacity: 0.2; }
.heatmap-cell.level-1 { background: rgba(33, 128, 141, 0.3); }
.heatmap-cell.level-2 { background: rgba(33, 128, 141, 0.5); }
.heatmap-cell.level-3 { background: rgba(33, 128, 141, 0.7); }
.heatmap-cell.level-4 { background: rgba(33, 128, 141, 1); }

.modal {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.5);
  z-index: 1000;
  align-items: center;
  justify-content: center;
}

.modal.active {
  display: flex;
}

.modal-content {
  background: var(--color-surface);
  border-radius: var(--radius-lg);
  padding: var(--space-24);
  max-width: 500px;
  width: 90%;
  max-height: 80vh;
  overflow-y: auto;
  box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
}

.modal-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: var(--space-20);
}

.modal-header h3 {
  font-size: 20px;
  font-weight: 600;
}

.btn-close {
  background: transparent;
  border: none;
  font-size: 24px;
  cursor: pointer;
  color: var(--color-text-secondary);
}

.btn-close:hover {
  color: var(--color-text);
}

.form-group {
  margin-bottom: var(--space-16);
}

.form-group label {
  display: block;
  margin-bottom: var(--space-8);
  font-size: 14px;
  font-weight: 500;
}

.form-group input,
.form-group textarea {
  width: 100%;
  padding: var(--space-12);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-base);
  font-family: var(--font-family-base);
  font-size: 14px;
  background: var(--color-background);
  color: var(--color-text);
}

.form-group textarea {
  resize: vertical;
  min-height: 80px;
}

.task-list {
  margin-top: var(--space-16);
}

.task-item {
  display: flex;
  align-items: center;
  gap: var(--space-12);
  padding: var(--space-12);
  background: var(--color-background);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-base);
  margin-bottom: var(--space-8);
}

.task-item input[type="checkbox"] {
  width: 18px;
  height: 18px;
  cursor: pointer;
}

.task-item.completed {
  opacity: 0.6;
}

.task-item.completed label {
  text-decoration: line-through;
}

.btn-primary {
  background: var(--color-primary);
  color: white;
  border: none;
  padding: var(--space-12) var(--space-24);
  border-radius: var(--radius-base);
  cursor: pointer;
  font-size: 14px;
  font-weight: 500;
  width: 100%;
  transition: background 0.2s;
}

.btn-primary:hover {
  background: var(--color-primary-hover);
}

.confetti {
  position: fixed;
  width: 10px;
  height: 10px;
  background: var(--color-primary);
  pointer-events: none;
  z-index: 9999;
  animation: confetti-fall 3s ease-out forwards;
}

@keyframes confetti-fall {
  to {
    transform: translateY(100vh) rotate(720deg);
    opacity: 0;
  }
}

@media (max-width: 1024px) {
  .main-content {
    grid-template-columns: 1fr;
  }
  
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
}

@media (max-width: 640px) {
  body {
    padding: var(--space-12);
  }
  
  .stats-grid {
    grid-template-columns: 1fr;
  }
  
  .calendar {
    gap: var(--space-4);
  }
  
  .calendar-day {
    font-size: 12px;
  }
}
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìä Calendario de Objetivos</h1>
            <div class="month-nav">
                <button onclick="changeMonth(-1)">‚Üê Anterior</button>
                <span id="currentMonth"></span>
                <button onclick="changeMonth(1)">Siguiente ‚Üí</button>
            </div>
        </div>

        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-card-header">
                    <span>Objetivos Activos</span>
                    <span class="stat-icon">üéØ</span>
                </div>
                <div class="stat-value" id="activeGoals">0</div>
                <div class="stat-trend trend-up">
                    <span>‚Üë</span>
                    <span>3 este mes</span>
                </div>
            </div>

            <div class="stat-card">
                <div class="stat-card-header">
                    <span>Completados</span>
                    <span class="stat-icon">‚úÖ</span>
                </div>
                <div class="stat-value" id="completedGoals">0</div>
                <div class="stat-trend trend-up">
                    <span>‚Üë</span>
                    <span>+25% vs mes anterior</span>
                </div>
            </div>

            <div class="stat-card">
                <div class="stat-card-header">
                    <span>Racha Actual</span>
                    <span class="stat-icon">üî•</span>
                </div>
                <div class="stat-value" id="currentStreak">0</div>
                <div class="stat-trend">
                    <span>d√≠as productivos</span>
                </div>
            </div>

            <div class="stat-card">
                <div class="stat-card-header">
                    <span>Promedio Mensual</span>
                    <span class="stat-icon">üìà</span>
                </div>
                <div class="stat-value" id="monthlyAverage">0%</div>
                <div class="stat-trend trend-up">
                    <span>‚Üë</span>
                    <span>Tendencia positiva</span>
                </div>
            </div>
        </div>

        <div class="main-content">
            <div class="calendar-section">
                <div class="calendar">
                    <div class="calendar-header">Dom</div>
                    <div class="calendar-header">Lun</div>
                    <div class="calendar-header">Mar</div>
                    <div class="calendar-header">Mi√©</div>
                    <div class="calendar-header">Jue</div>
                    <div class="calendar-header">Vie</div>
                    <div class="calendar-header">S√°b</div>
                </div>
                <div class="calendar" id="calendarGrid"></div>
            </div>

            <div class="sidebar">
                <div class="objectives-section">
                    <div class="section-header">
                        <h2>Objetivos</h2>
                        <button class="btn-add" onclick="openObjectiveModal()">+ Agregar</button>
                    </div>
                    <div id="objectivesList"></div>
                </div>

                <div class="heatmap-section">
                    <div class="section-header">
                        <h2>Mapa de Calor</h2>
                    </div>
                    <div class="heatmap-grid" id="heatmapGrid"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal" id="dayModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">Detalles del D√≠a</h3>
                <button class="btn-close" onclick="closeDayModal()">√ó</button>
            </div>
            <div class="form-group">
                <label>Nueva Tarea</label>
                <input type="text" id="newTask" placeholder="Escribe una tarea...">
                <button class="btn-primary" style="margin-top: 8px;" onclick="addTask()">Agregar Tarea</button>
            </div>
            <div class="task-list" id="taskList"></div>
        </div>
    </div>

    <div class="modal" id="objectiveModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="objectiveModalTitle">Nuevo Objetivo</h3>
                <button class="btn-close" onclick="closeObjectiveModal()">√ó</button>
            </div>
            <div class="form-group">
                <label>T√≠tulo</label>
                <input type="text" id="objectiveTitle" placeholder="Ej: Aumentar ventas">
            </div>
            <div class="form-group">
                <label>Descripci√≥n</label>
                <textarea id="objectiveDesc" placeholder="Describe tu objetivo..."></textarea>
            </div>
            <div class="form-group">
                <label>Meta Num√©rica (%)</label>
                <input type="number" id="objectiveTarget" min="0" max="100" value="100">
            </div>
            <div class="form-group">
                <label>Progreso Actual (%)</label>
                <input type="number" id="objectiveCurrent" min="0" max="100" value="0">
            </div>
            <button class="btn-primary" onclick="saveObjective()">Guardar Objetivo</button>
        </div>
    </div>

    <script>
let currentDate = new Date();
let selectedDay = null;
let editingObjectiveId = null;

// Cargar datos desde localStorage
function loadData() {
    const savedObjectives = localStorage.getItem('calendarObjectives');
    const savedDayData = localStorage.getItem('calendarDayData');
    
    if (savedObjectives) {
        return {
            objectives: JSON.parse(savedObjectives),
            dayData: savedDayData ? JSON.parse(savedDayData) : {}
        };
    }
    
    // Datos de ejemplo solo si es la primera vez
    return {
        objectives: [
            {
                id: 1,
                title: "Aumentar Ingresos",
                description: "Meta de crecimiento mensual",
                target: 100,
                current: 90,
                status: "progress"
            },
            {
                id: 2,
                title: "Clientes Nuevos",
                description: "Adquirir 50 clientes nuevos",
                target: 100,
                current: 65,
                status: "progress"
            },
            {
                id: 3,
                title: "Satisfacci√≥n Cliente",
                description: "Mantener calificaci√≥n 4.5+",
                target: 100,
                current: 100,
                status: "completed"
            },
            {
                id: 4,
                title: "Capacitaci√≥n Personal",
                description: "Entrenar al equipo completo",
                target: 100,
                current: 20,
                status: "delayed"
            }
        ],
        dayData: {}
    };
}

// Guardar datos en localStorage
function saveData() {
    localStorage.setItem('calendarObjectives', JSON.stringify(objectives));
    localStorage.setItem('calendarDayData', JSON.stringify(dayData));
}

const initialData = loadData();
let objectives = initialData.objectives;
let dayData = initialData.dayData;

function initCalendar() {
    renderCalendar();
    renderObjectives();
    renderHeatmap();
    updateStats();
    updateMonthDisplay();
}

function updateMonthDisplay() {
    const months = ['Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio', 
                    'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'];
    document.getElementById('currentMonth').textContent = 
        `${months[currentDate.getMonth()]} ${currentDate.getFullYear()}`;
}

function changeMonth(delta) {
    currentDate.setMonth(currentDate.getMonth() + delta);
    renderCalendar();
    renderHeatmap();
    updateMonthDisplay();
}

function renderCalendar() {
    const grid = document.getElementById('calendarGrid');
    const year = currentDate.getFullYear();
    const month = currentDate.getMonth();
    
    const firstDay = new Date(year, month, 1).getDay();
    const daysInMonth = new Date(year, month + 1, 0).getDate();
    const today = new Date();
    
    grid.innerHTML = '';
    
    for (let i = 0; i < firstDay; i++) {
        const emptyDay = document.createElement('div');
        emptyDay.className = 'calendar-day empty';
        grid.appendChild(emptyDay);
    }
    
    for (let day = 1; day <= daysInMonth; day++) {
        const dayDiv = document.createElement('div');
        dayDiv.className = 'calendar-day';
        
        const dateKey = `${year}-${month}-${day}`;
        const dayInfo = dayData[dateKey] || { tasks: [] };
        
        const completedTasks = dayInfo.tasks.filter(t => t.completed).length;
        const totalTasks = dayInfo.tasks.length;
        
        if (totalTasks > 0) {
            if (completedTasks === totalTasks) {
                dayDiv.classList.add('success');
            } else if (completedTasks > 0) {
                dayDiv.classList.add('partial');
            } else {
                dayDiv.classList.add('pending');
            }
        }
        
        if (today.getDate() === day && today.getMonth() === month && today.getFullYear() === year) {
            dayDiv.classList.add('today');
        }
        
        dayDiv.innerHTML = `
            <span class="day-number">${day}</span>
            ${totalTasks > 0 ? `<span class="day-tasks">${completedTasks}/${totalTasks}</span>` : ''}
        `;
        
        dayDiv.onclick = () => openDayModal(day);
        grid.appendChild(dayDiv);
    }
}

function openDayModal(day) {
    selectedDay = day;
    const dateKey = `${currentDate.getFullYear()}-${currentDate.getMonth()}-${day}`;
    
    document.getElementById('modalTitle').textContent = `Tareas - ${day} de ${getMonthName()}`;
    document.getElementById('dayModal').classList.add('active');
    
    if (!dayData[dateKey]) {
        dayData[dateKey] = { tasks: [] };
    }
    
    renderTasks();
}

function closeDayModal() {
    document.getElementById('dayModal').classList.remove('active');
    renderCalendar();
}

function getMonthName() {
    const months = ['Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio', 
                    'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'];
    return months[currentDate.getMonth()];
}

function addTask() {
    const input = document.getElementById('newTask');
    const taskText = input.value.trim();
    
    if (!taskText) return;
    
    const dateKey = `${currentDate.getFullYear()}-${currentDate.getMonth()}-${selectedDay}`;
    
    if (!dayData[dateKey]) {
        dayData[dateKey] = { tasks: [] };
    }
    
    dayData[dateKey].tasks.push({
        id: Date.now(),
        text: taskText,
        completed: false
    });
    
    input.value = '';
    saveData();
    renderTasks();
    updateStats();
}

function toggleTask(taskId) {
    const dateKey = `${currentDate.getFullYear()}-${currentDate.getMonth()}-${selectedDay}`;
    const task = dayData[dateKey].tasks.find(t => t.id === taskId);
    
    if (task) {
        task.completed = !task.completed;
        saveData();
        renderTasks();
        updateStats();
    }
}

function renderTasks() {
    const dateKey = `${currentDate.getFullYear()}-${currentDate.getMonth()}-${selectedDay}`;
    const tasks = dayData[dateKey]?.tasks || [];
    const container = document.getElementById('taskList');
    
    if (tasks.length === 0) {
        container.innerHTML = '<p style="color: var(--color-text-secondary); text-align: center; padding: 20px;">No hay tareas para este d√≠a</p>';
        return;
    }
    
    container.innerHTML = tasks.map(task => `
        <div class="task-item ${task.completed ? 'completed' : ''}">
            <input type="checkbox" ${task.completed ? 'checked' : ''} 
                   onchange="toggleTask(${task.id})">
            <label>${task.text}</label>
        </div>
    `).join('');
}

function renderObjectives() {
    const container = document.getElementById('objectivesList');
    
    container.innerHTML = objectives.map(obj => {
        const percentage = obj.current;
        let statusClass = 'status-progress';
        let statusText = 'En progreso';
        
        if (percentage >= 100) {
            statusClass = 'status-completed';
            statusText = 'Completado';
        } else if (percentage < 30) {
            statusClass = 'status-delayed';
            statusText = 'Atrasado';
        }
        
        return `
            <div class="objective-item">
                <div class="objective-header">
                    <div>
                        <div class="objective-title">${obj.title}</div>
                        <div class="objective-desc">${obj.description}</div>
                    </div>
                    <div class="objective-actions">
                        <button class="btn-icon" onclick="editObjective(${obj.id})">‚úèÔ∏è</button>
                        <button class="btn-icon" onclick="deleteObjective(${obj.id})">üóëÔ∏è</button>
                    </div>
                </div>
                <div class="progress-section">
                    <div class="progress-header">
                        <span class="progress-label">${obj.current}/${obj.target}</span>
                        <span class="progress-percentage">${percentage}%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${percentage}%"></div>
                    </div>
                </div>
                <span class="objective-status ${statusClass}">${statusText}</span>
            </div>
        `;
    }).join('');
}

function openObjectiveModal() {
    editingObjectiveId = null;
    document.getElementById('objectiveModalTitle').textContent = 'Nuevo Objetivo';
    document.getElementById('objectiveTitle').value = '';
    document.getElementById('objectiveDesc').value = '';
    document.getElementById('objectiveTarget').value = '100';
    document.getElementById('objectiveCurrent').value = '0';
    document.getElementById('objectiveModal').classList.add('active');
}

function closeObjectiveModal() {
    document.getElementById('objectiveModal').classList.remove('active');
}

function editObjective(id) {
    const obj = objectives.find(o => o.id === id);
    if (!obj) return;
    
    editingObjectiveId = id;
    document.getElementById('objectiveModalTitle').textContent = 'Editar Objetivo';
    document.getElementById('objectiveTitle').value = obj.title;
    document.getElementById('objectiveDesc').value = obj.description;
    document.getElementById('objectiveTarget').value = obj.target;
    document.getElementById('objectiveCurrent').value = obj.current;
    document.getElementById('objectiveModal').classList.add('active');
}

function saveObjective() {
    const title = document.getElementById('objectiveTitle').value.trim();
    const description = document.getElementById('objectiveDesc').value.trim();
    const target = parseInt(document.getElementById('objectiveTarget').value);
    const current = parseInt(document.getElementById('objectiveCurrent').value);
    
    if (!title) {
        alert('Por favor ingresa un t√≠tulo');
        return;
    }
    
    if (editingObjectiveId) {
        const obj = objectives.find(o => o.id === editingObjectiveId);
        if (obj) {
            const wasCompleted = obj.current >= 100;
            obj.title = title;
            obj.description = description;
            obj.target = target;
            obj.current = current;
            obj.status = current >= 100 ? 'completed' : current < 30 ? 'delayed' : 'progress';
            
            if (!wasCompleted && current >= 100) {
                celebrateCompletion();
            }
        }
    } else {
        objectives.push({
            id: Date.now(),
            title,
            description,
            target,
            current,
            status: current >= 100 ? 'completed' : current < 30 ? 'delayed' : 'progress'
        });
    }
    
    saveData();
    closeObjectiveModal();
    renderObjectives();
    updateStats();
}

function deleteObjective(id) {
    if (confirm('¬øEst√°s seguro de eliminar este objetivo?')) {
        objectives = objectives.filter(o => o.id !== id);
        saveData();
        renderObjectives();
        updateStats();
    }
}

function celebrateCompletion() {
    for (let i = 0; i < 50; i++) {
        setTimeout(() => {
            const confetti = document.createElement('div');
            confetti.className = 'confetti';
            confetti.style.left = Math.random() * 100 + '%';
            confetti.style.background = ['#21808D', '#32B8C6', '#4ADE80', '#FACC15'][Math.floor(Math.random() * 4)];
            confetti.style.animationDelay = Math.random() * 0.5 + 's';
            document.body.appendChild(confetti);
            
            setTimeout(() => confetti.remove(), 3000);
        }, i * 30);
    }
}

function updateStats() {
    const active = objectives.filter(o => o.current < 100).length;
    const completed = objectives.filter(o => o.current >= 100).length;
    
    document.getElementById('activeGoals').textContent = active;
    document.getElementById('completedGoals').textContent = completed;
    
    let streak = 0;
    const today = new Date();
    for (let i = 0; i < 30; i++) {
        const checkDate = new Date(today);
        checkDate.setDate(checkDate.getDate() - i);
        const dateKey = `${checkDate.getFullYear()}-${checkDate.getMonth()}-${checkDate.getDate()}`;
        const dayInfo = dayData[dateKey];
        
        if (dayInfo && dayInfo.tasks.length > 0 && dayInfo.tasks.some(t => t.completed)) {
            streak++;
        } else if (i > 0) {
            break;
        }
    }
    
    document.getElementById('currentStreak').textContent = streak;
    
    const totalProgress = objectives.reduce((sum, obj) => sum + obj.current, 0);
    const average = objectives.length > 0 ? Math.round(totalProgress / objectives.length) : 0;
    document.getElementById('monthlyAverage').textContent = average + '%';
}

function renderHeatmap() {
    const grid = document.getElementById('heatmapGrid');
    const year = currentDate.getFullYear();
    const month = currentDate.getMonth();
    const daysInMonth = new Date(year, month + 1, 0).getDate();
    
    grid.innerHTML = '';
    
    for (let day = 1; day <= daysInMonth; day++) {
        const dateKey = `${year}-${month}-${day}`;
        const dayInfo = dayData[dateKey];
        
        const cell = document.createElement('div');
        cell.className = 'heatmap-cell';
        
        if (dayInfo && dayInfo.tasks.length > 0) {
            const completed = dayInfo.tasks.filter(t => t.completed).length;
            const total = dayInfo.tasks.length;
            const ratio = completed / total;
            
            if (ratio === 0) {
                cell.classList.add('level-0');
            } else if (ratio <= 0.25) {
                cell.classList.add('level-1');
            } else if (ratio <= 0.5) {
                cell.classList.add('level-2');
            } else if (ratio <= 0.75) {
                cell.classList.add('level-3');
            } else {
                cell.classList.add('level-4');
            }
        } else {
            cell.classList.add('level-0');
        }
        
        grid.appendChild(cell);
    }
}

initCalendar();
    </script>
</body>
</html>
